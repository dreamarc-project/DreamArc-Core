# ============================================================
# DreamArc QuickLoad Core v4.4.1
# External Loader Core (GitHub Edition / AutoPatch)
# ============================================================

meta:
  id: "QuickLoad-Core"
  version: "4.4.1-GA"
  role: "boot_core"
  last_updated: "2025-12-01"
  description: >
    DreamArc OS external boot core.
    v4.4.1 adds Prompt/Exclude AutoPatch:
    - Universal Exclude Baseline ã‚’å¸¸æ™‚ãƒãƒ¼ã‚¸
    - Prompt ãŒçŸ­ã™ãã‚‹å ´åˆã®è‡ªå‹•è£œå®Œ
    - Exclude ãŒè²§å¼±ãªå ´åˆã®è‡ªå‹•æ‹¡å¼µï¼ˆbaseline + auto-mapï¼‰

# ------------------------------------------------------------
# Path Resolution / Validation
# ------------------------------------------------------------

path_config:
  base_url: "https://raw.githubusercontent.com/dreamarc-project/DreamArc-Core/main/"
  resolve_mode: "relative"      # relative / absolute
  cache_enabled: true

validation:
  check_paths_on_load: true
  report_missing_files: true
  fallback_behavior: "warn"     # error / warn / silent

# ------------------------------------------------------------
# Core Components
# ------------------------------------------------------------

components:
  dasf:
    spec: "DASF/DASF_v2.2-PhonemeAssist.md"

  syntax_modules:
    production_dir: "Modules/production"
    # ã“ã“ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå˜ä½ãƒ­ãƒ¼ãƒ‰ï¼ˆDA-OS-YO.yaml / DA-OS-NANA.yaml / DA-OS-KG-LR.yaml ãªã©ï¼‰
    load_mode: "directory"      # directory / explicit-list
    allow_lab_modules: false

  persona_registry:
    file: "PersonaRegistry/registry.yaml"

  exclude_engine:
    engine:   "ExcludeEngine/exclude-engine-v4.0.yaml"
    baseline: "ExcludeEngine/exclude-baseline-v1.1.yaml"
    auto_map: "ExcludeEngine/auto/auto-map-v1.1.json"
    persona_map: "ExcludeEngine/persona-exclude-map-v1.0.yaml"

    conflict_resolution:
      enabled: true
      check_include_exclude_overlap: true
      priority: "include_first"   # include_first / exclude_first
      log_conflicts: true
      action: "warn"              # error / warn / auto_resolve

  include_engine:
    engine: "IncludeEngine/include-engine-v1.0.yaml"

  output_spec:
    triple_block: true          # ğŸ§ / ğŸµ / ğŸš«
    outer_header_mode: true
    layout: "Unified Directive Layout"
    language: "JP-hiragana-main"

  runtime_flags:
    quickload_lock: true
    auto_dispatch: true
    verify_modules: true

# ------------------------------------------------------------
# Prompt / Exclude AutoPatch
# ------------------------------------------------------------

autopatch:
  enabled: true

  prompt:
    min_length_chars: 30
    # ã“ã‚Œã‚ˆã‚ŠçŸ­ã„å ´åˆã¯ QuickLoad å´ã§è‡ªå‹•çš„ã«è£œè¶³ã‚¿ã‚°ã‚’è¿½åŠ ã™ã‚‹æƒ³å®š
    auto_append_tags:
      - "SongStructure:DASF"
      - "Language:JP"
      - "Output:TripleBlock"
    normalize:
      to_katakana: false        # false = ã²ã‚‰ãŒãªç¶­æŒ
      keep_user_style: true

  exclude:
    min_items: 5
    # Exclude ãŒçŸ­ã™ãã‚‹å ´åˆã¯ Baseline + AutoMap ã‚’å¼·åˆ¶ãƒãƒ¼ã‚¸ã—ã¦ã€Œè¦‹ãŸç›®ã«ã‚‚ååˆ†ãªé•·ã•ã€ã«ã™ã‚‹
    behavior_if_too_weak: "auto_expand"   # auto_expand / warn_only / ignore

    merge_order:
      - "baseline"   # Universal Baselineï¼ˆå¸¸ã«é©ç”¨ï¼‰
      - "auto"       # Prompt è§£æã«ã‚ˆã‚‹ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥æ’é™¤
      - "persona"    # ãƒšãƒ«ã‚½ãƒŠå›ºæœ‰ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
      - "syntax"     # æ§‹æ–‡OSå´ã§è¿½åŠ ã•ã‚Œã‚‹ã‚‚ã®ï¼ˆä»»æ„ï¼‰
      - "custom"     # ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰‹å‹• Exclude

    output_mode: "expanded"      # compact / expanded
    # expanded ã§ã¯ã€Baseline ç”±æ¥ã®ä»£è¡¨ã‚«ãƒ†ã‚´ãƒªã‚‚ DASF Exclude å‡ºåŠ›ã«å«ã‚ã‚‹
    # â†’ ã‘ã°ã•ã‚“ã®ã€Œãƒ†ã‚¹ãƒˆè¦–èªæ€§ã€ã‚’æº€ãŸã™ãŸã‚ã®ãƒ¢ãƒ¼ãƒ‰

# ------------------------------------------------------------
# Mode Detection (SyntaxOS / Persona / Freestyle)
# ------------------------------------------------------------

mode_detection:
  priority:
    - "syntax_os"   # æ§‹æ–‡OSï¼ˆDA-OS-YO / DA-OS-NANA / DA-OS-KG-LR ç­‰ï¼‰æŒ‡å®šãŒæœ€å„ªå…ˆ
    - "persona"     # ãƒšãƒ«ã‚½ãƒŠæŒ‡å®šï¼ˆä¾‹: æ˜Ÿå´ã‚¢ãƒªã‚¢ / é»’é‹¼ãƒ¬ãƒ³ï¼‰
    - "freestyle"   # ã©ã¡ã‚‰ã‚‚ç„¡ã„å ´åˆã¯ãƒ•ãƒªãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«

  syntax_os:
    default_when_ambiguous: "none"   # none = ç„¡ç†ã«æ¨å®šã—ãªã„
    allow_manual_override: true

  persona:
    allow_multi: false
    fallback_to_universal_profile: true

  freestyle:
    # æ§‹æ–‡OSã‚’ä½¿ã‚ãªã„å ´åˆã§ã‚‚ ExcludeEngine ãŒ Universal Baseline + AutoMap ã‚’ä½¿ã£ã¦æœ€ä½é™ã®å®‰å…¨æ€§ã‚’ä¿è¨¼
    use_universal_exclude: true
    use_auto_map: true
    use_persona_profile_if_available: true

# ------------------------------------------------------------
# DASF Output Normalization
# ------------------------------------------------------------

output_normalization:
  enabled: true

  prompt:
    ensure_non_empty: true
    # Prompt ãŒæ¥µç«¯ã«çŸ­ã„ã¨ãã¯ã€autopatch.prompt.auto_append_tags ã‚’ä»˜åŠ ã—ã¦
    # ã€Œä¸€å¿œDASFã¨ã—ã¦è¦‹ãŸã¨ãã«åˆæ ¼ç‚¹ã€ã«ã™ã‚‹ã€‚
    append_structure_hint: true  # ä¾‹: "DASFæ§‹æ–‡ã§ã®ä¸‰ãƒ–ãƒ­ãƒƒã‚¯å‡ºåŠ›ã‚’å‰æã¨ã™ã‚‹" çš„ãªæ„å‘³åˆã„ã‚’æš—é»™ã«å«ã‚ã‚‹

  exclude:
    ensure_min_items: 5
    inject_baseline_summary: true
    # ä¾‹:
    #   explicit violence, explicit sexual content, real singer names, real band names,
    #   political references, hate speech, extreme gore, slurs, doxxing content
    #
    # ã¨ã„ã†ã‚ˆã†ã«ã€Baselineå´ã®ä¸»è¦ã‚«ãƒ†ã‚´ãƒªã‚’ Exclude è¡¨ç¤ºä¸Šã«ã‚‚è¿½åŠ ã™ã‚‹ã€‚

  lyrics:
    enforce_triple_block: true   # ğŸ§ / ğŸµ / ğŸš« ã® 3ãƒ–ãƒ­ãƒƒã‚¯ã‚’å¿…é ˆ
    enforce_unified_layout: true

# ------------------------------------------------------------
# AI Profile Hooks
# ------------------------------------------------------------

ai_profile_hooks:
  chatgpt:
    default_profile: "QuickLoad/profiles/profile-chatgpt-v1.0.yaml"
    allow_override: true

  claude:
    default_profile: "QuickLoad/profiles/profile-claude-v1.0.yaml"
    allow_override: true

  gemini:
    default_profile: "QuickLoad/profiles/profile-gemini-v1.0.yaml"
    allow_override: true

  universal:
    default_profile: "QuickLoad/profiles/profile-universal-v1.0.yaml"

# ============================================================
# END OF FILE
# ============================================================
