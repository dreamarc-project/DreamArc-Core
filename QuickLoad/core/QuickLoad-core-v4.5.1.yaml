# ============================================================
# DreamArc-Core / QuickLoad Core Engine
# File: QuickLoad-core-v4.5.1.yaml
# Version: 4.5.1
# Description:
#   - Central orchestration layer for DreamArc QuickLoad
#   - Handles prompt cleaning, include/exclude merging,
#     syntax module attach, and final output assembly.
#   - Ensures ZERO syntax leakage into FinalPrompt.
# ============================================================

meta:
  id: "QuickLoadCore"
  version: "4.5.1"
  updated: "2025-12-01"
  purpose: "Stabilized Core Engine for QuickLoad v4.5.1"

# ------------------------------------------------------------
# Layer Definitions
# ------------------------------------------------------------
layers:

  # ----------------------------------------------------------
  # LAYER 1: Raw Prompt Ingestion
  # ----------------------------------------------------------
  prompt_raw:
    id: "PromptRaw"
    description: "User-supplied raw prompt (no processing applied)."

  # ----------------------------------------------------------
  # LAYER 2: Prompt Cleaner v4.5
  # ----------------------------------------------------------
  prompt_cleaner:
    enabled: true
    engine_file: "regex/prompt-cleaner-v4.5.yaml"
    input: "PromptRaw"
    output: "PromptClean"
    enforce_no_syntax_leak: true

  # ----------------------------------------------------------
  # LAYER 3: ExcludeEngine v4.5
  # ----------------------------------------------------------
  exclude_engine:
    enabled: true
    engine_file: "ExcludeEngine/exclude-engine-v4.5.yaml"
    input: "PromptClean"
    output: "PromptExcludeApplied"
    merge_strategy: "append"

  # ----------------------------------------------------------
  # LAYER 4: IncludeEngine v4.5
  # ----------------------------------------------------------
  include_engine:
    enabled: true
    engine_file: "IncludeEngine/include-engine-v4.5.yaml"
    input: "PromptExcludeApplied"
    output: "PromptIncludeApplied"
    merge_strategy: "append"

  # ----------------------------------------------------------
  # LAYER 5: Prompt Finalizer
  # ----------------------------------------------------------
  prompt_builder:
    enabled: true
    input: "PromptIncludeApplied"
    output: "FinalPrompt"
    join_separator: ","
    remove_empty_tokens: true

  # ----------------------------------------------------------
  # LAYER 6: Lyrics Builder (構文と分離済)
  # ----------------------------------------------------------
  lyrics_builder:
    enabled: true
    id: "LyricsCore"
    description: "Lyrics generated by DASF (Unified Directive Layout)."
    expect_directive_layout: true

  # ----------------------------------------------------------
  # LAYER 7: SyntaxModule Attach (newline_tail)
  # ----------------------------------------------------------
  syntax_module_attach:
    enabled: true
    attach_position: "newline_tail"
    newline_before_tag: true
    export_meta_to_prompt: false
    input: "LyricsCore"
    output: "LyricsFinal"

  # ----------------------------------------------------------
  # LAYER 8: Output Assembly (TripleBlock)
  # ----------------------------------------------------------
  output_format:
    id: "OutputSpec"
    prompt: "FinalPrompt"
    lyrics: "LyricsFinal"
    block_mode: "TripleBlock"
    code_fence: true
    outer_header: true
    unified_directive_layout: true

# ------------------------------------------------------------
# System Options
# ------------------------------------------------------------
options:
  persona_registry_sync: true
  creator_expansion_mode: "ENABLED"
  auto_rebind: true
  verify_modules: true
  display_spec: "JP v2.9"

# ============================================================
# END OF FILE
# ============================================================
